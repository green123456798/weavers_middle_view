CREATE TABLE MEMBER ( -- 회원 테이블
	
	MID VARCHAR2(100) PRIMARY KEY, --회원 고유 ID
	MPW VARCHAR2(100) NOT NULL, -- 회원 비밀번호
	NAME VARCHAR2(100) NOT NULL, --회원 이름
	BIRTH DATE NOT NULL, -- 회원 생년월일
	PHONE VARCHAR2(100) NOT NULL, -- 회원 전화번호
	NICKNAME VARCHAR2(100) NOT NULL UNIQUE, -- 회원 닉네임
	EMAIL VARCHAR2(100), -- 회원 이메일
	MARKETING INT DEFAULT 0,	-- 회원 이메일 수신 동의 0 : 미수신
	GPK INT DEFAULT 2 NOT NULL -- 등급 고유 번호 : GRADE FK
);

CREATE TABLE GRADE ( -- 회원 등급 테이블

	GPK INT PRIMARY KEY, -- 회원 등급 고유 번호
	GRADE VARCHAR2(100) NOT NULL -- 회원 등급 
	--PK 1 : 관리자
	--PK 2 : 일반
	--PK 3 : VIP
	--PK 4 : VVIP
	--PK 5 : 탈퇴
);

INSERT INTO GRADE VALUES (2,'일반') ;
INSERT INTO GRADE VALUES (5,'탈퇴') ;

CREATE TABLE PRODUCT ( -- 상품 테이블
	
	PPK INT PRIMARY KEY, -- 상품 고유 번호
	PNAME VARCHAR2(100) NOT NULL, -- 상품 이름
	PRICE INT NOT NULL, -- 상품 가격
	SALES INT  DEFAULT 0 NOT NULL, -- 상품 판매량 기본값 : 0
	REGDATE DATE  DEFAULT SYSDATE NOT NULL, -- 상품 등록일
	DETAIL VARCHAR2(4000) NOT NULL, -- 상품 상세설명
	IMG VARCHAR2(4000) NOT NULL -- 상품 사진

);

CREATE TABLE WISHLIST( -- 상품 찜 목록 테이블
	
	WPK INT PRIMARY KEY, -- 상품 찜 고유 번호
	MID VARCHAR2(100) NOT NULL, -- 회원 ID : MEMBER FK
	PPK INT NOT NULL -- 상품 고유 번호 : PRODUCT FK
);

CREATE TABLE BUYPRODUCT ( -- 구매 상품 번호 테이블
	
	BPK INT PRIMARY KEY, -- 구매 상품 고유 번호
	PPK INT NOT NULL, -- 상품 고유 번호 : PRODUCT FK
	CNT INT NOT NULL, --상품 개수
	SPK INT NOT NULL -- 주문 번호 : SERIAL FK

);

CREATE TABLE SERIAL ( -- 구매 상품 테이블

	SPK INT PRIMARY KEY, -- 구매 고유 번호 (시리얼넘버)
	MID VARCHAR2(100) NOT NULL, -- 회원 ID : MEMBER FK
	REGDATE DATE DEFAULT SYSDATE NOT NULL,  -- 회원이 구매한 날짜 
	DELIVERYADDRESS VARCHAR2(4000) NOT NULL --회원 배송지
);

CREATE TABLE CART ( -- 장바구니 테이블
	
	CPK INT PRIMARY KEY, -- 장바구니 고유 번호
	MID VARCHAR2(100) NOT NULL, -- 회원 ID : MEMBER FK
	PPK INT NOT NULL, -- 상품 고유 번호 : PRODUCT FK
 	CNT INT NOT NULL -- 회원이 구매한 개수

);

CREATE TABLE ADDRESS ( -- 배송지 테이블
 
	APK INT PRIMARY KEY, -- 배송지 고유 번호
	MID VARCHAR2(100) NOT NULL, -- 회원 ID : MEMBER FK
	ZONECODE VARCHAR2(10) NOT NULL, -- 우편 번호 
	JIBUNADDRESS VARCHAR2(4000) , -- 지번 주소
	ROADADDRESS VARCHAR2(4000) NOT NULL, -- 도로명 주소
	DETAIL VARCHAR2(4000), -- 상세 주소 : 없을 수도 있어서 NOT NULL 사용 안함.
	ANAME VARCHAR2(100) NOT NULL
);

CREATE TABLE REVIEW ( -- 리뷰 테이블

	RPK INT PRIMARY KEY, -- 리뷰 고유 번호
	MID VARCHAR2(100) NOT NULL, -- 회원 ID : MEMBER FK
	BPK INT NOT NULL,
	CONTENT VARCHAR2(4000) , -- 리뷰 내용
	SCOPE INT  DEFAULT 0 NOT NULL, -- 별점
	IMG VARCHAR2(4000), -- 리뷰 사진
	REGDATE DATE DEFAULT SYSDATE NOT NULL -- 리뷰 작성 일자
);


INSERT INTO MEMBER (MID, MPW, NAME, BIRTH, PHONE, NICKNAME, EMAIL, MARKETING, GPK)
VALUES ('qwer', '1234', '아리', '2024-01-14', '01012341235', '아리', 'abc@abcd.com', 0, DEFAULT );

INSERT INTO MEMBER (MID, MPW, NAME, BIRTH, PHONE, NICKNAME, EMAIL, MARKETING, GPK)
VALUES ('asd', '1234', '아트룩스', '2024-01-20', '01012341238', '아트', 'abc@abcde.com', 0, DEFAULT );

INSERT INTO MEMBER (MID, MPW, NAME, BIRTH, PHONE, NICKNAME, EMAIL, MARKETING, GPK)
VALUES ('zxc', '1234', '오리아나', '2024-01-22', '01012341236', '오리아나', 'abcd@abcd.com', 0, DEFAULT );

INSERT INTO MEMBER (MID, MPW, NAME, BIRTH, PHONE, NICKNAME, EMAIL, MARKETING, GPK)
VALUES ('poi', '1234', '티모', '2024-01-22', '01012341237', '티모', 'abcde@abcd.com', 0, DEFAULT );

INSERT INTO WISHLIST VALUES((SELECT NVL(MAX(WPK),0) +1 FROM WISHLIST),'user',1);
INSERT INTO WISHLIST VALUES((SELECT NVL(MAX(WPK),0) +1 FROM WISHLIST),'user',12);
INSERT INTO WISHLIST VALUES((SELECT NVL(MAX(WPK),0) +1 FROM WISHLIST),'user',13);
INSERT INTO WISHLIST VALUES((SELECT NVL(MAX(WPK),0) +1 FROM WISHLIST),'user',20);
INSERT INTO WISHLIST VALUES((SELECT NVL(MAX(WPK),0) +1 FROM WISHLIST),'qwer',1);
INSERT INTO WISHLIST VALUES((SELECT NVL(MAX(WPK),0) +1 FROM WISHLIST),'qwer',2);
INSERT INTO WISHLIST VALUES((SELECT NVL(MAX(WPK),0) +1 FROM WISHLIST),'qwer',3);
INSERT INTO WISHLIST VALUES((SELECT NVL(MAX(WPK),0) +1 FROM WISHLIST),'qwer',14);
INSERT INTO WISHLIST VALUES((SELECT NVL(MAX(WPK),0) +1 FROM WISHLIST),'asd',2);
INSERT INTO WISHLIST VALUES((SELECT NVL(MAX(WPK),0) +1 FROM WISHLIST),'asd',4);
INSERT INTO WISHLIST VALUES((SELECT NVL(MAX(WPK),0) +1 FROM WISHLIST),'asd',15);
INSERT INTO WISHLIST VALUES((SELECT NVL(MAX(WPK),0) +1 FROM WISHLIST),'asd',16);
INSERT INTO WISHLIST VALUES((SELECT NVL(MAX(WPK),0) +1 FROM WISHLIST),'zxc',5);
INSERT INTO WISHLIST VALUES((SELECT NVL(MAX(WPK),0) +1 FROM WISHLIST),'zxc',6);
INSERT INTO WISHLIST VALUES((SELECT NVL(MAX(WPK),0) +1 FROM WISHLIST),'zxc',7);
INSERT INTO WISHLIST VALUES((SELECT NVL(MAX(WPK),0) +1 FROM WISHLIST),'zxc',8);
INSERT INTO WISHLIST VALUES((SELECT NVL(MAX(WPK),0) +1 FROM WISHLIST),'zxc',17);
INSERT INTO WISHLIST VALUES((SELECT NVL(MAX(WPK),0) +1 FROM WISHLIST),'zxc',18);
INSERT INTO WISHLIST VALUES((SELECT NVL(MAX(WPK),0) +1 FROM WISHLIST),'poi',9);
INSERT INTO WISHLIST VALUES((SELECT NVL(MAX(WPK),0) +1 FROM WISHLIST),'poi',10);
INSERT INTO WISHLIST VALUES((SELECT NVL(MAX(WPK),0) +1 FROM WISHLIST),'poi',11);
INSERT INTO WISHLIST VALUES((SELECT NVL(MAX(WPK),0) +1 FROM WISHLIST),'poi',19);
INSERT INTO WISHLIST VALUES((SELECT NVL(MAX(WPK),0) +1 FROM WISHLIST),'poi',20);


INSERT INTO SERIAL VALUES ((SELECT NVL(MAX(SPK),0)+1 FROM SERIAL),'user',DEFAULT,'집');
INSERT INTO SERIAL VALUES ((SELECT NVL(MAX(SPK),0)+1 FROM SERIAL),'qwer',DEFAULT,'회사');
INSERT INTO SERIAL VALUES ((SELECT NVL(MAX(SPK),0)+1 FROM SERIAL),'asd',DEFAULT,'집');
INSERT INTO SERIAL VALUES ((SELECT NVL(MAX(SPK),0)+1 FROM SERIAL),'zxc',DEFAULT,'집');
INSERT INTO SERIAL VALUES ((SELECT NVL(MAX(SPK),0)+1 FROM SERIAL),'poi',DEFAULT,'집');
INSERT INTO SERIAL VALUES ((SELECT NVL(MAX(SPK),0)+1 FROM SERIAL),'poi',DEFAULT,'집');
INSERT INTO SERIAL VALUES ((SELECT NVL(MAX(SPK),0)+1 FROM SERIAL),'zxc',DEFAULT,'집');
INSERT INTO SERIAL VALUES ((SELECT NVL(MAX(SPK),0)+1 FROM SERIAL),'qwer',DEFAULT,'집');
INSERT INTO SERIAL VALUES ((SELECT NVL(MAX(SPK),0)+1 FROM SERIAL),'user',DEFAULT,'집');

INSERT INTO CART VALUES((SELECT NVL(MAX(CPK),0)+1 FROM CART),'asd',1,1);
INSERT INTO CART VALUES((SELECT NVL(MAX(CPK),0)+1 FROM CART),'zxc',2,2);
INSERT INTO CART VALUES((SELECT NVL(MAX(CPK),0)+1 FROM CART),'asd',4,1);
INSERT INTO CART VALUES((SELECT NVL(MAX(CPK),0)+1 FROM CART),'poi',15,3);
INSERT INTO CART VALUES((SELECT NVL(MAX(CPK),0)+1 FROM CART),'zxc',20,1);
INSERT INTO CART VALUES((SELECT NVL(MAX(CPK),0)+1 FROM CART),'user',19,2);

INSERT INTO ADDRESS VALUES ((SELECT NVL(MAX(APK),0)+1 FROM ADDRESS),'asd', '01234', '서울 지번 ', '서울 도로명', '1301호', '집');
INSERT INTO ADDRESS VALUES ((SELECT NVL(MAX(APK),0)+1 FROM ADDRESS),'qwer', '01235', '서울 지번 ', '서울 도로명', '102호', '집');
INSERT INTO ADDRESS VALUES ((SELECT NVL(MAX(APK),0)+1 FROM ADDRESS),'zxc', '01236', '서울 지번 ', '서울 도로명', '202호', '집');
INSERT INTO ADDRESS VALUES ((SELECT NVL(MAX(APK),0)+1 FROM ADDRESS),'asd', '01237', '서울 지번 ', '서울 도로명', '101호', '집');
INSERT INTO ADDRESS VALUES ((SELECT NVL(MAX(APK),0)+1 FROM ADDRESS),'poi', '01238', '서울 지번 ', '서울 도로명', '1601호', '집');
INSERT INTO ADDRESS VALUES ((SELECT NVL(MAX(APK),0)+1 FROM ADDRESS),'asd', '01239', '서울 지번 ', '서울 도로명', '1502호', '집');
INSERT INTO ADDRESS VALUES ((SELECT NVL(MAX(APK),0)+1 FROM ADDRESS),'zxc', '01240', '서울 지번 ', '서울 도로명', '1401호', '집');

SELECT R.RPK, R.CONTENT, R.SCOPE, R.IMG, R.REGDATE, M.NICKNAME, M.GPK 
FROM REVIEW R 
JOIN MEMBER M ON(R.MID = M.MID) 
JOIN BUYPRODUCT B ON (R.BPK = B.BPK) 
WHERE B.PPK=1 ORDER BY R.REGDATE DESC;



INSERT INTO REVIEW VALUES ((SELECT NVL(MAX(RPK),0)+1 FROM REVIEW),'qwer',2,'좋아요',2,'sample1.jpg',SYSDATE);
INSERT INTO REVIEW VALUES ((SELECT NVL(MAX(RPK),0)+1 FROM REVIEW),'asd',3,'그럭저럭 쓸만합니다.',3,'sample2.jpg',SYSDATE);
INSERT INTO REVIEW VALUES ((SELECT NVL(MAX(RPK),0)+1 FROM REVIEW),'asd',4,'별로입니다.',3,'sample3.jpg',SYSDATE);
INSERT INTO REVIEW VALUES ((SELECT NVL(MAX(RPK),0)+1 FROM REVIEW),'asd',5,'믿고 구매해요!',3,'sample4.jpg',SYSDATE);

INSERT INTO REVIEW VALUES ((SELECT NVL(MAX(RPK),0)+1 FROM REVIEW),'zxc',6,'피부가 좋아졌어요!~',5,'sample5.jpg',SYSDATE);
INSERT INTO REVIEW VALUES ((SELECT NVL(MAX(RPK),0)+1 FROM REVIEW),'zxc',7,'2번째 구매 역시 최고',5,'sample6.jpg',SYSDATE);
INSERT INTO REVIEW VALUES ((SELECT NVL(MAX(RPK),0)+1 FROM REVIEW),'qwer',8,'최고최고최고',3,'sample7.jpg',SYSDATE);
INSERT INTO REVIEW VALUES ((SELECT NVL(MAX(RPK),0)+1 FROM REVIEW),'qwer',9,'그냥 그래요',3,'sample8.jpg',SYSDATE);

INSERT INTO REVIEW VALUES ((SELECT NVL(MAX(RPK),0)+1 FROM REVIEW),'qwer',10,'좋습니다.',4, 'sample9.jpg' ,SYSDATE);

UPDATE REVIEW SET IMG = NULL WHERE BPK=10;

INSERT INTO BUYPRODUCT VALUES (1,1,10,1);
INSERT INTO BUYPRODUCT VALUES (2,1,2,2);
INSERT INTO BUYPRODUCT VALUES (3,4,1,3);
INSERT INTO BUYPRODUCT VALUES (4,5,1,4);
INSERT INTO BUYPRODUCT VALUES (5,6,7,5);
INSERT INTO BUYPRODUCT VALUES (6,7,1,6);
INSERT INTO BUYPRODUCT VALUES (7,8,2,7);
INSERT INTO BUYPRODUCT VALUES (8,9,3,8);
INSERT INTO BUYPRODUCT VALUES (9,1,2,8);
INSERT INTO BUYPRODUCT VALUES (10,2,2,8);
INSERT INTO BUYPRODUCT VALUES (11,4,15,9);

SELECT P.PPK, P.PNAME, P.IMG, B.BPK 
FROM PRODUCT P
JOIN BUYPRODUCT B
ON B.PPK=P.PPK;
